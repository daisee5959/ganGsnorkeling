import React, { useState, useEffect } from 'react';

export default function RealSudoku() {
  // Google Font ë¡œë“œ
  useEffect(() => {
    const link = document.createElement('link');
    link.href = 'https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap';
    link.rel = 'stylesheet';
    document.head.appendChild(link);
  }, []);

  // 19ipgyrftì˜ 9ê°œ ê¸€ì
  const symbols = ['1', '9', 'i', 'p', 'g', 'y', 'r', 'f', 't'];
  
  // ì™„ì„±ëœ ìŠ¤ë„ì¿  ì •ë‹µ
  const solution = [
    ['1', '9', 'i', 'p', 'g', 'y', 'r', 'f', 't'],
    ['p', 'g', 'y', 'r', 'f', 't', '1', '9', 'i'],
    ['r', 'f', 't', '1', '9', 'i', 'p', 'g', 'y'],
    ['9', 'i', 'p', 'g', 'y', 'r', 'f', 't', '1'],
    ['g', 'y', 'r', 'f', 't', '1', '9', 'i', 'p'],
    ['f', 't', '1', '9', 'i', 'p', 'g', 'y', 'r'],
    ['i', 'p', 'g', 'y', 'r', 'f', 't', '1', '9'],
    ['y', 'r', 'f', 't', '1', '9', 'i', 'p', 'g'],
    ['t', '1', '9', 'i', 'p', 'g', 'y', 'r', 'f'],
  ];

  // ì´ˆê¸° í¼ì¦ (ë¹ˆì¹¸ 8ê°œ ì¶”ê°€)
  const initialPuzzle = [
    ['1', '9', 'i', '', 'g', '', '', '', 't'],
    ['p', '', 'y', 'r', '', '', '1', '9', ''],
    ['r', 'f', '', '', '', 'i', 'p', '', ''],
    ['9', 'i', '', '', 'y', '', '', 't', '1'],
    ['g', '', 'r', 'f', 't', '1', '', '', ''],
    ['', 't', '1', '', '', 'p', 'g', 'y', ''],
    ['i', '', 'g', 'y', '', '', 't', '', '9'],
    ['y', 'r', '', '', '1', '9', '', 'p', ''],
    ['t', '1', '9', 'i', 'p', '', '', 'r', 'f'],
  ];

  const [grid, setGrid] = useState(initialPuzzle.map(row => [...row]));
  const [showResult, setShowResult] = useState(false);
  const [selectedCell, setSelectedCell] = useState(null);
  const [timeLeft, setTimeLeft] = useState(null);
  const [isTimeUp, setIsTimeUp] = useState(false);
  const [hintsUsed, setHintsUsed] = useState(0);
  const maxHints = 5;
  
  // ëœë¤ ìˆœì„œë¡œ ë²„íŠ¼ ë°°ì¹˜
  const [shuffledSymbols] = useState(() => {
    const shuffled = [...symbols];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  });

  // íƒ€ì´ë¨¸
  useEffect(() => {
    const deadline = new Date('2025-12-13T00:00:00+09:00').getTime();
    
    const timer = setInterval(() => {
      const now = new Date().getTime();
      const distance = deadline - now;
      
      if (distance < 0) {
        setIsTimeUp(true);
        clearInterval(timer);
        setTimeLeft({ days: 0, hours: 0, minutes: 0, seconds: 0 });
      } else {
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        setTimeLeft({ days, hours, minutes, seconds });
      }
    }, 1000);
    
    return () => clearInterval(timer);
  }, []);

  const isInitialCell = (row, col) => {
    return initialPuzzle[row][col] !== '';
  };

  const handleCellClick = (row, col) => {
    if (!isInitialCell(row, col) && !showResult && !isTimeUp) {
      setSelectedCell({ row, col });
    }
  };

  const handleSymbolClick = (symbol) => {
    if (selectedCell && !isTimeUp) {
      const newGrid = grid.map(row => [...row]);
      newGrid[selectedCell.row][selectedCell.col] = symbol;
      setGrid(newGrid);
    }
  };

  const handleClear = () => {
    if (selectedCell && !isTimeUp) {
      const newGrid = grid.map(row => [...row]);
      newGrid[selectedCell.row][selectedCell.col] = '';
      setGrid(newGrid);
    }
  };

  const useHint = () => {
    if (hintsUsed >= maxHints || isTimeUp) return;
    
    // ë¹ˆ ì¹¸ ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤ìœ¼ë¡œ ì±„ìš°ê¸°
    const emptyCells = [];
    grid.forEach((row, i) => {
      row.forEach((cell, j) => {
        if (cell === '' && !isInitialCell(i, j)) {
          emptyCells.push({ row: i, col: j });
        }
      });
    });
    
    if (emptyCells.length > 0) {
      const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
      const newGrid = grid.map(row => [...row]);
      newGrid[randomCell.row][randomCell.col] = solution[randomCell.row][randomCell.col];
      setGrid(newGrid);
      setHintsUsed(hintsUsed + 1);
    }
  };

  const checkAnswer = () => {
    setShowResult(true);
  };

  const isComplete = grid.every(row => row.every(cell => cell !== ''));

  const isCorrect = grid.every((row, i) => 
    row.every((cell, j) => cell === solution[i][j])
  );

  const reset = () => {
    setGrid(initialPuzzle.map(row => [...row]));
    setShowResult(false);
    setSelectedCell(null);
    setHintsUsed(0);
  };

  const getCellStyle = (row, col) => {
    const borderRight = (col + 1) % 3 === 0 && col !== 8 ? 'border-r-4' : 'border-r';
    const borderBottom = (row + 1) % 3 === 0 && row !== 8 ? 'border-b-4' : 'border-b';
    return `${borderRight} ${borderBottom}`;
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-sky-200 via-cyan-100 to-blue-200 flex items-center justify-center p-4" style={{ fontFamily: "'Fredoka', sans-serif" }}>
      <div className="w-full max-w-6xl flex flex-col items-center relative z-10">
        {!showResult ? (
          <>
            {isTimeUp ? (
              <div className="bg-gradient-to-br from-white to-sky-50 rounded-3xl shadow-2xl p-12 border-4 border-red-400 text-center">
                <div className="text-8xl mb-6">â°</div>
                <h2 className="text-5xl font-bold text-red-500 mb-8 drop-shadow-md">
                  ì‹œê°„ ì¢…ë£Œ!
                </h2>
                <p className="text-2xl text-red-400 mb-8 font-semibold">
                  ì œí•œ ì‹œê°„ì´ ëë‚¬ì–´ìš”! ğŸ˜¢
                </p>
                <p className="text-xl text-blue-600 mb-8">
                  ë‹¤ìŒ ê¸°íšŒì— ë„ì „í•´ë³´ì„¸ìš”!
                </p>
              </div>
            ) : (
              <>
                {/* íƒ€ì´ë¨¸ */}
                {timeLeft && (
                  <div className="bg-white/80 backdrop-blur-sm rounded-full px-8 py-3 mb-4 border border-cyan-200 shadow-lg mx-auto w-fit">
                    <div className="flex gap-1 justify-center items-center text-2xl font-bold text-blue-600">
                      <span>{timeLeft.days}</span>
                      <span className="text-cyan-400">:</span>
                      <span>{String(timeLeft.hours).padStart(2, '0')}</span>
                      <span className="text-cyan-400">:</span>
                      <span>{String(timeLeft.minutes).padStart(2, '0')}</span>
                      <span className="text-cyan-400">:</span>
                      <span>{String(timeLeft.seconds).padStart(2, '0')}</span>
                    </div>
                  </div>
                )}

                {/* ê²Œì„ ì„¤ëª… */}
                <div className="text-center mb-6">
                  <p className="text-blue-600 text-sm font-medium max-w-md mx-auto">
                    ê° ê°€ë¡œì¤„, ì„¸ë¡œì¤„, 3Ã—3 ë°•ìŠ¤ì—<br/>
                    ëª¨ë“  ê¸€ìê°€ í•œ ë²ˆì”© ë“¤ì–´ê°€ì•¼ í•´ìš”
                  </p>
                </div>

                <div className="text-center mb-8">
                  <p className="text-blue-500 text-sm font-medium">
                  i, t, f, 9, p, 1, y, g, r
                </p>

                <div className="flex flex-col lg:flex-row gap-6 items-center justify-center w-full">
                  {/* ìŠ¤ë„ì¿  ê·¸ë¦¬ë“œ */}
                  <div className="bg-gradient-to-br from-white to-sky-50 rounded-2xl p-4 md:p-6 border-4 border-cyan-300 shadow-2xl mx-auto">
                    <div className="grid grid-cols-9 gap-0 bg-cyan-200 p-1 rounded-xl mx-auto w-fit">
                      {grid.map((row, rowIndex) => (
                        row.map((cell, colIndex) => (
                          <div
                            key={`${rowIndex}-${colIndex}`}
                            onClick={() => handleCellClick(rowIndex, colIndex)}
                            className={`
                              w-8 h-8 md:w-12 md:h-12 flex items-center justify-center text-xl md:text-3xl font-bold
                              border-cyan-300 cursor-pointer transition-all
                              ${getCellStyle(rowIndex, colIndex)}
                              ${isInitialCell(rowIndex, colIndex) 
                                ? 'bg-cyan-100 cursor-not-allowed text-blue-500' 
                                : 'bg-white hover:bg-sky-100 text-blue-600'}
                              ${selectedCell?.row === rowIndex && selectedCell?.col === colIndex 
                                ? 'ring-4 ring-yellow-300 bg-yellow-50' 
                                : ''}
                            `}
                          >
                            {cell}
                          </div>
                        ))
                      ))}
                    </div>
                  </div>

                  {/* ì…ë ¥ íŒ¨ë„ */}
                  <div className="w-full lg:w-auto mx-auto">
                    <div className="bg-gradient-to-br from-white to-sky-50 rounded-2xl p-6 border-2 border-cyan-300 shadow-xl mx-auto max-w-sm">
                      <div className="grid grid-cols-3 gap-2 mb-4">
                        {shuffledSymbols.map(symbol => (
                          <button
                            key={symbol}
                            onClick={() => handleSymbolClick(symbol)}
                            disabled={!selectedCell}
                            className="w-14 h-14 md:w-16 md:h-16 text-2xl md:text-3xl font-bold bg-gradient-to-br from-sky-100 to-cyan-100 hover:from-sky-200 hover:to-cyan-200 rounded-xl border-2 border-cyan-300 disabled:opacity-30 disabled:cursor-not-allowed transition-all transform hover:scale-105 active:scale-95 shadow-md text-blue-600"
                          >
                            {symbol}
                          </button>
                        ))}
                      </div>
                      <button
                        onClick={handleClear}
                        disabled={!selectedCell}
                        className="w-full py-3 text-lg font-bold bg-red-50 hover:bg-red-100 text-red-500 rounded-xl border-2 border-red-200 disabled:opacity-30 disabled:cursor-not-allowed transition-all mb-4"
                      >
                        ì§€ìš°ê¸°
                      </button>
                      <button
                        onClick={useHint}
                        disabled={hintsUsed >= maxHints}
                        className="w-full py-3 text-lg font-bold bg-yellow-50 hover:bg-yellow-100 text-yellow-600 rounded-xl border-2 border-yellow-200 disabled:opacity-30 disabled:cursor-not-allowed transition-all mb-4"
                      >
                        ğŸ’¡ íŒíŠ¸ ({hintsUsed}/{maxHints})
                      </button>
                      <button
                        onClick={checkAnswer}
                        disabled={!isComplete}
                        className="w-full py-4 text-xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl border-2 border-cyan-300 disabled:opacity-30 disabled:cursor-not-allowed transition-all transform hover:scale-105 shadow-lg"
                      >
                        ì •ë‹µ í™•ì¸
                      </button>
                      {!isComplete && (
                        <p className="text-blue-400 text-sm text-center mt-2 font-semibold">
                          ëª¨ë“  ì¹¸ì„ ì±„ì›Œì£¼ì„¸ìš”
                        </p>
                      )}
                    </div>
                  </div>
                </div>
              </>
            )}
          </>
        ) : (
          <div className="bg-gradient-to-br from-white to-sky-50 rounded-3xl shadow-2xl p-12 border-4 border-cyan-300 text-center">
            {isCorrect ? (
              <>
                <h2 className="text-5xl font-bold text-blue-600 mb-4 drop-shadow-md">
                  ì¶•í•˜í•©ë‹ˆë‹¤
                </h2>
                <p className="text-2xl text-cyan-600 mb-4 font-semibold">
                  ë‹¹ì‹ ì„ ê°„ì§€ í­í’ìœ¼ë¡œ ì´ˆëŒ€í•©ë‹ˆë‹¤
                </p>
                <p className="text-lg text-blue-500 mb-2 font-bold">
                  ê°„ì§€ í­í’ì˜ ì½”ë“œ
                </p>
                <p className="text-3xl text-blue-700 mb-8 font-bold tracking-wider">
                  19ipgyrft
                </p>
              </>
            ) : (
              <>
                <h2 className="text-5xl font-bold text-pink-500 mb-4 drop-shadow-md">
                  ë–¼ì‰
                </h2>
                <p className="text-xl text-blue-600 mb-8 font-semibold">
                  ë‚˜ë§ŒëŒ€ê³µ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”
                </p>
              </>
            )}
            <button
              onClick={reset}
              className="bg-gradient-to-r from-cyan-400 to-blue-400 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-4 px-12 rounded-full shadow-lg transform hover:scale-105 transition-all text-lg border-2 border-cyan-300"
            >
              ë‹¤ì‹œ í•˜ê¸°
            </button>
          </div>
        )}
      </div>
    </div>
  );
}
